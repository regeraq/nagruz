#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ GitHub –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞

set -e

echo "=========================================="
echo "  –ü–û–õ–ù–ê–Ø –û–ß–ò–°–¢–ö–ê GITHUB –ò –ü–ï–†–ï–ó–ê–ì–†–£–ó–ö–ê"
echo "=========================================="
echo ""

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd "$(dirname "$0")"

echo "üìÅ –¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: $(pwd)"
echo ""

# –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å Git
echo "üîç –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Git..."
git status
echo ""

# –®–∞–≥ 2: –£–¥–∞–ª—è–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –∏–∑ –∏–Ω–¥–µ–∫—Å–∞ Git
echo "üóëÔ∏è  –®–∞–≥ 2: –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ –∏–Ω–¥–µ–∫—Å–∞ Git..."
git rm -rf --cached . || true
echo ""

# –®–∞–≥ 3: –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –∑–∞–Ω–æ–≤–æ (attached_assets –±—É–¥–µ—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω)
echo "üì¶ –®–∞–≥ 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞..."
git add -A
echo ""

# –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ attached_assets –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω
echo "‚úÖ –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ attached_assets –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω..."
if git status | grep -q "attached_assets"; then
    echo "‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: attached_assets –Ω–∞–π–¥–µ–Ω –≤ –∏–Ω–¥–µ–∫—Å–µ!"
    echo "–£–¥–∞–ª—è–µ–º –∏–∑ –∏–Ω–¥–µ–∫—Å–∞..."
    git rm -rf --cached attached_assets || true
else
    echo "‚úÖ attached_assets –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è"
fi
echo ""

# –®–∞–≥ 5: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
echo "üìä –®–∞–≥ 5: –°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω–∏–π:"
git status --short | head -30
echo ""

# –®–∞–≥ 6: –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–∏—Ç
echo "üíæ –®–∞–≥ 6: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞..."
git commit -m "Complete project rewrite - clean version without attached_assets" || echo "–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
echo ""

# –®–∞–≥ 7: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞ GitHub
echo "üöÄ –®–∞–≥ 7: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ GitHub..."
echo "‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –Ω–∞ GitHub!"
read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (y/n): " -n 1 -r
echo ""
if [[ $REPLY =~ ^[Yy]$ ]]; then
    git push origin main --force
    echo ""
    echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ GitHub."
    echo "üîó –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: https://github.com/regeraq/nagruz"
else
    echo "‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º"
fi


