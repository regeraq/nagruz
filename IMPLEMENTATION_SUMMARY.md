# –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `commercial_proposal_files` –≤ —Å—Ö–µ–º–µ –ë–î
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å–≤—è–∑–∏ —Å `contact_submissions` –∏ `users`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã relations –¥–ª—è Drizzle ORM

### 2. Backend –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–µ—Ä–≤–∏—Å `FileService` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–µ—Ä–≤–∏—Å `CommercialProposalService` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–µ—Ä–≤–∏—Å `LoggerService` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –£–ª—É—á—à–µ–Ω middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å `requireRole`
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `api/` –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ä–æ—É—Ç–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω middleware –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 3. API Endpoints
- ‚úÖ `POST /api/commercial/:id/files` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
- ‚úÖ `GET /api/commercial/:id/files` - —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ `DELETE /api/commercial/:id/files/:fileId` - —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ (admin)
- ‚úÖ `GET /api/files/:fileId/download` - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
- ‚úÖ `GET /api/admin/contacts/:id` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ —Å —Ñ–∞–π–ª–∞–º–∏ (admin)
- ‚úÖ `GET /api/auth/commercial-proposals` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è UUID –∏ —á–∏—Å–ª–æ–≤—ã—Ö ID
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤ (–∑–∞—â–∏—Ç–∞ –æ—Ç path traversal)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è MIME-—Ç–∏–ø–æ–≤
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç IDOR (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–º)
- ‚úÖ Rate limiting –Ω–∞ –≤—Å–µ—Ö endpoints
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (–≤–ª–∞–¥–µ–ª–µ—Ü –∏–ª–∏ admin)
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π (–∑–∞—â–∏—Ç–∞ –æ—Ç DoS)

### 5. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ñ–∞–π–ª–∞–º–∏ (upload, download, delete)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π

### 6. Frontend
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ "–§–∞–π–ª—ã" –≤ —Ç–∞–±–ª–∏—Ü–µ –∑–∞—è–≤–æ–∫
  - –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ—Å–º–æ—Ç—Ä" –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –¥–µ—Ç–∞–ª–µ–π
  - –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏ –∏ —Å–ø–∏—Å–∫–æ–º —Ñ–∞–π–ª–æ–≤
  - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∫–ª–∞–¥–∫–∞ "–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è"
  - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å —Ñ–∞–π–ª–∞–º–∏
  - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤

### 7. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `/api/contact` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –≤ –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏

## üìã –û—Å—Ç–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å

### –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î
**–°—Ç–∞—Ç—É—Å**: –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

**–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è**:
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `.env` —É–∫–∞–∑–∞–Ω `DATABASE_URL`
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ: `cd HelloWhoAreYou-1 && npm run db:push`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã

–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ —Ñ–∞–π–ª–µ `MIGRATION_GUIDE.md`

## üîí –£–ª—É—á—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**:
   - UUID –∏ —á–∏—Å–ª–æ–≤—ã–µ ID
   - –ò–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ (–∑–∞—â–∏—Ç–∞ –æ—Ç path traversal)
   - MIME-—Ç–∏–ø—ã
   - –†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤

2. **–ó–∞—â–∏—Ç–∞ –æ—Ç IDOR**:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–º
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º

3. **–ó–∞—â–∏—Ç–∞ –æ—Ç DoS**:
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π (MAX_PROPOSALS = 100)
   - Rate limiting –Ω–∞ –≤—Å–µ—Ö endpoints
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤

4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
   - –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ñ–∞–π–ª–∞–º–∏
   - –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
server/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ commercial/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ files.ts          # API –¥–ª—è —Ñ–∞–π–ª–æ–≤ –ö–ü
‚îÇ   ‚îî‚îÄ‚îÄ files/
‚îÇ       ‚îî‚îÄ‚îÄ download.ts       # API –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts               # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ security.ts           # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–Ω–æ–≤—ã–π)
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ files.ts              # –°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ commercial.ts         # –°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç—ã —Å –ö–ü
‚îÇ   ‚îî‚îÄ‚îÄ logger.ts             # –°–µ—Ä–≤–∏—Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ routes.ts                 # –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–æ—É—Ç—ã

shared/
‚îî‚îÄ‚îÄ schema.ts                  # –°—Ö–µ–º–∞ –ë–î —Å –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ–π

client/src/pages/
‚îú‚îÄ‚îÄ admin.tsx                  # –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
‚îî‚îÄ‚îÄ profile.tsx                # –û–±–Ω–æ–≤–ª–µ–Ω –ø—Ä–æ—Ñ–∏–ª—å
```

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î** (—Å–º. MIGRATION_GUIDE.md)
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å —Ñ–∞–π–ª–æ–º
   - –ü—Ä–æ—Å–º–æ—Ç—Ä –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
   - –ü—Ä–æ—Å–º–æ—Ç—Ä –≤ –ø—Ä–æ—Ñ–∏–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –§–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ base64 –≤ –ë–î (–¥–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫–µ/S3)
- –°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –≤ `contact_submissions.fileName` –∏ `fileData` –æ—Å—Ç–∞—é—Ç—Å—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–∞ –æ–¥–Ω–æ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞—â–∏—â–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

