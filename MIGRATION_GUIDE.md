# Руководство по миграции базы данных

## Добавление таблицы для файлов коммерческих предложений

### Шаг 1: Настройка переменных окружения

Убедитесь, что в файле `.env` (в корне проекта `HelloWhoAreYou-1`) указан `DATABASE_URL`:

```env
DATABASE_URL=postgresql://user:password@localhost:5432/database_name
```

### Шаг 2: Применение миграции

Выполните команду для применения изменений схемы БД:

```bash
cd HelloWhoAreYou-1
npm run db:push
```

Эта команда создаст таблицу `commercial_proposal_files` в вашей базе данных.

### Шаг 3: Проверка

После успешного выполнения миграции проверьте, что таблица создана:

```sql
SELECT * FROM commercial_proposal_files LIMIT 1;
```

### Структура новой таблицы

Таблица `commercial_proposal_files` содержит следующие поля:

- `id` - уникальный идентификатор файла (UUID)
- `proposal_id` - ID коммерческого предложения (связь с `contact_submissions`)
- `user_id` - ID пользователя, загрузившего файл (связь с `users`)
- `file_name` - имя файла
- `mime_type` - MIME-тип файла
- `file_size` - размер файла в байтах
- `file_path` - путь к файлу или base64 данные
- `uploaded_at` - дата загрузки
- `created_at` - дата создания записи

### Обратная совместимость

Старые файлы, сохраненные в полях `file_name` и `file_data` таблицы `contact_submissions`, продолжают работать. Новые файлы сохраняются в отдельную таблицу.

### Важные замечания

1. **Резервное копирование**: Перед применением миграции рекомендуется создать резервную копию базы данных.

2. **Производственная среда**: В production используйте миграции через `drizzle-kit generate` и `drizzle-kit migrate` вместо `db:push`.

3. **Права доступа**: Убедитесь, что пользователь БД имеет права на создание таблиц.

